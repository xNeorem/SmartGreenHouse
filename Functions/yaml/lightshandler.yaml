metadata:
  name: lightshandler
  labels:
    nuclio.io/project-name: 01df174d-761a-41e8-8bed-a7995d354b0a
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-lightshandler:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    photoresistorTrigget:
      class: ""
      kind: mqtt
      url: "192.168.1.4:1883"
      username: guest
      password: guest
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/sensors/photoresistor
  build:
    functionSourceCode: Y29uc3QgYW1xcCA9IHJlcXVpcmUoJ2FtcXBsaWInKQ0KY29uc3QgbXF0dCA9IHJlcXVpcmUoJ21xdHQnKQ0KDQpjb25zdCBsb2cgPSAiaW90L2xvZ3MiDQpjb25zdCBtb25pdG9yID0gImlvdC9tb25pdG9yIg0KY29uc3QgbGlnaHRzID0gImlvdC9kZXZpY2VzL2xpZ2h0cyINCnZhciBjdXJyTGlnaHRzU3RhdGUgPSBmYWxzZQ0KDQpjb25zdCB1cmwgPSAnbXF0dDovLzE5Mi4xNjguMS40Jw0KDQpjb25zdCBvcHRpb25zID0gew0KICAgIHBvcnQ6IDE4ODMsDQogICAgaG9zdDogdXJsLA0KICAgIGNsaWVudElkOiAnbXF0dGpzXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHIoMiwgOCksDQogICAgdXNlcm5hbWU6ICdndWVzdCcsDQogICAgcGFzc3dvcmQ6ICdndWVzdCcsDQp9Ow0KDQoNCmZ1bmN0aW9uIHNlbmRGZWVkYmFja0FtcXAocXVldWUsbXNnKXsNCiAgICBhbXFwLmNvbm5lY3QoJ2FtcXA6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjEuNDo1NjcyJykudGhlbihmdW5jdGlvbihjb25uKSB7DQogICAgICAgIHJldHVybiBjb25uLmNyZWF0ZUNoYW5uZWwoKS50aGVuKGZ1bmN0aW9uKGNoKSB7DQogICAgICAgICAgICBjb25zdCBvayA9IGNoLmFzc2VydFF1ZXVlKHF1ZXVlLCB7ZHVyYWJsZTogZmFsc2V9KTsNCiAgICAgICAgICAgIHJldHVybiBvay50aGVuKGZ1bmN0aW9uKF9xb2spIHsNCiAgICAgICAgICAgIGNoLnNlbmRUb1F1ZXVlKHF1ZXVlLCBCdWZmZXIuZnJvbShtc2cpKTsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCIgW3hdIFNlbnQgJyVzJyIsIG1zZyk7DQogICAgICAgICAgICByZXR1cm4gY2guY2xvc2UoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uKCkgeyANCiAgICAgICAgICAgICAgICBjb25uLmNsb3NlKCk7DQogICAgICAgICAgICB9KTsNCiAgICB9KS5jYXRjaChjb25zb2xlLndhcm4pOw0KfQ0KDQpmdW5jdGlvbiBzZW5kRmVlZGJhY2tNcXR0KHEsbXNnKXsNCg0KICAgIGNvbnN0IGNsaWVudCA9IG1xdHQuY29ubmVjdCh1cmwsIG9wdGlvbnMpOw0KDQogICAgY2xpZW50Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKSB7DQogICAgICAgIGNsaWVudC5wdWJsaXNoKHEsIG1zZyx7cW9zOjJ9LGZ1bmN0aW9uKCl7DQogICAgICAgICAgICBjbGllbnQuZW5kKCk7DQogICAgICAgIH0pOyAgICAgICAgICAgICANCiAgICB9KTsgICAgICAgIA0KfQ0KDQpmdW5jdGlvbiBiaW4yc3RyaW5nKGFycmF5KXsNCiAgICB2YXIgcmVzdWx0ID0gIiI7DQogICAgZm9yKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKXsNCiAgICAgICAgcmVzdWx0ICs9IChTdHJpbmcuZnJvbUNoYXJDb2RlKGFycmF5W2ldKSkNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGV2ZW50KSB7DQogICAgdmFyIF9ldmVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZXZlbnQpKQ0KICAgIHZhciBfZGF0YSA9IGJpbjJzdHJpbmcoX2V2ZW50LmJvZHkuZGF0YSkNCg0KICAgIGNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrICIrX2RhdGEpDQoNCiAgICB2YXIgdGVtcCA9IHBhcnNlSW50KF9kYXRhKQ0KICAgIGlmKHRlbXAgPD0gNDApew0KICAgICAgICBpZighY3VyckxpZ2h0c1N0YXRlKXsNCiAgICAgICAgICAgIGN1cnJMaWdodHNTdGF0ZSA9IHRydWUNCiAgICAgICAgICAgIHNlbmRGZWVkYmFja01xdHQobGlnaHRzLCJ0cnVlIikNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmKHRlbXAgPj0gNzApew0KICAgICAgICBpZihjdXJyTGlnaHRzU3RhdGUpew0KICAgICAgICAgICAgY3VyckxpZ2h0c1N0YXRlID0gZmFsc2UNCiAgICAgICAgICAgIHNlbmRGZWVkYmFja01xdHQobGlnaHRzLCJmYWxzZSIpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBjb25zb2xlLmxvZygiVFJJR0dFUiAiK19kYXRhKTsNCiAgICBzZW5kRmVlZGJhY2tBbXFwKGxvZywiTGlnaHRuZXNzIDogIitfZGF0YSk7DQogICAgc2VuZEZlZWRiYWNrQW1xcChtb25pdG9yLCJMaWdodG5lc3MgOiAiK19kYXRhKQ0KfTs=
    commands:
      - 'npm install amqplib'
      - 'npm install mqtt'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
  version: 1
